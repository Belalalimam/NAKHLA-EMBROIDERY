@model NAKHLA.Models.Product
@{
    ViewBag.Title = "Add New Product";
    ViewBag.PageTitle = "Add Product";

    var categories = ViewBag.Categories as List<NAKHLA.Models.Category> ?? new List<NAKHLA.Models.Category>();
    var brands = ViewBag.Brands as List<NAKHLA.Models.Brand> ?? new List<NAKHLA.Models.Brand>();
    var validationErrors = ViewBag.ValidationErrors as List<string> ?? new List<string>();
}

@if (validationErrors.Any())
{
    <div class="alert alert-danger">
        <h5>Validation Errors:</h5>
        <ul>
            @foreach (var error in validationErrors)
            {
                <li>@error</li>
            }
        </ul>
    </div>
}
<div class="page-header">
    <div>
        <h2>Add New Product</h2>
        <p class="page-subtitle">Create a new product in your catalog</p>
    </div>
    <div class="header-actions">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to List
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form asp-action="Create" method="post" id="createProductForm">
            @Html.AntiForgeryToken()

            <!-- Hidden fields for required properties -->
            <input type="hidden" asp-for="IsDeleted" value="false" />
            <input type="hidden" asp-for="IsInStock" value="true" />
            <input type="hidden" asp-for="ManageStock" value="true" />
            <input type="hidden" asp-for="IsNew" value="true" />
            <input type="hidden" asp-for="DisplayOrder" value="0" />
            <input type="hidden" asp-for="ViewsCount" value="0" />
            <input type="hidden" asp-for="Traffic" value="0" />
            <input type="hidden" asp-for="Rate" value="0" />
            <input type="hidden" asp-for="ReviewCount" value="0" />
            <input type="hidden" asp-for="AverageRating" value="0" />
            <input type="hidden" asp-for="LowStockThreshold" value="10" />
            <input type="hidden" asp-for="BackordersAllowed" value="false" />
            <input type="hidden" asp-for="Discount" value="0" />
            <input type="hidden" asp-for="HasVariations" value="false" />
            <input type="hidden" asp-for="IsDownloadable" value="false" />
            <input type="hidden" asp-for="IsVirtual" value="false" />
            <input type="hidden" asp-for="RequiresShipping" value="true" />
            <input type="hidden" asp-for="Taxable" value="true" />

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label asp-for="Name" class="form-label">Product Name *</label>
                        <input asp-for="Name" class="form-control" placeholder="Enter product name" required>
                        <span asp-validation-for="Name" class="text-danger"></span>
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="SKU" class="form-label">SKU *</label>
                        <input asp-for="SKU" class="form-control" placeholder="PROD-001">
                        <span asp-validation-for="SKU" class="text-danger"></span>
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="Slug" class="form-label">URL Slug</label>
                        <input asp-for="Slug" class="form-control" placeholder="product-name">
                        <span asp-validation-for="Slug" class="text-danger"></span>
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="ShortDescription" class="form-label">Short Description</label>
                        <textarea asp-for="ShortDescription" class="form-control" rows="2" placeholder="Brief description"></textarea>
                        <span asp-validation-for="ShortDescription" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label asp-for="CategoryId" class="form-label">Category *</label>
                        <select asp-for="CategoryId" class="form-control" required>
                            <option value="">Select Category</option>
                            @foreach (var category in categories)
                            {
                                <option value="@category.Id">@category.Name</option>
                            }
                        </select>
                        <span asp-validation-for="CategoryId" class="text-danger"></span>
                    </div>




                    <div class="form-group mb-3">
                        <label>Project Categories</label>
                        <select name="SelectedProjectCategoryIds" class="form-control" multiple>
                            @foreach (var category in ViewBag.ProjectCategories as List<NAKHLA.Models.ProjectCategory>)
                            {
                                <option value="@category.Id">@category.Name</option>
                            }
                        </select>
                        <small>Hold Ctrl/Cmd to select multiple categories</small>

                    </div>

                    <!-- Fabric Type -->
                    <div class="form-group mb-3">
                        <label asp-for="FabricTypeId" class="form-label">Fabric Type</label>
                        <select asp-for="FabricTypeId" class="form-control">
                            <option value="">Select Fabric Type</option>
                            @{
                                var fabricTypes = ViewBag.FabricTypes as List<NAKHLA.Models.FabricType> ?? new List<NAKHLA.Models.FabricType>();
                            }
                            @foreach (var fabric in fabricTypes)
                            {
                                <option value="@fabric.Id">@fabric.Name</option>
                            }
                        </select>
                        <span asp-validation-for="FabricTypeId" class="text-danger"></span>
                    </div>

                    <!-- Product Colors (Multiple Selection) -->
                    <div class="form-group mb-3">
                        <label class="form-label">Product Colors</label>
                        <div id="color-container">
                            <div class="input-group mb-2">
                                <input type="text" name="Colors[]" class="form-control" placeholder="Enter color (e.g., Blue, Red)">
                                <button type="button" class="btn btn-outline-danger remove-color">×</button>
                            </div>
                        </div>
                        <button type="button" id="add-color" class="btn btn-sm btn-secondary mt-2">
                            <i class="fas fa-plus"></i> Add Color
                        </button>
                        <small class="text-muted">Enter each color in a separate field</small>
                    </div>

                    <!-- Composition -->
                    <div class="form-group mb-3">
                        <label asp-for="Composition" class="form-label">Fabric Composition</label>
                        <textarea asp-for="Composition" class="form-control" rows="2" placeholder="e.g., 100% Cotton, 60% Polyester 40% Cotton"></textarea>
                        <span asp-validation-for="Composition" class="text-danger"></span>
                    </div>








                    <div class="form-group mb-3">
                        <label asp-for="BrandId" class="form-label">Brand</label>
                        <select asp-for="BrandId" class="form-control">
                            <option value="">Select Brand</option>
                            @foreach (var brand in brands)
                            {
                                <option value="@brand.Id">@brand.Name</option>
                            }
                        </select>
                        <span asp-validation-for="BrandId" class="text-danger"></span>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label asp-for="Price" class="form-label">Price ($) *</label>
                                <input asp-for="Price" type="number" step="0.01" class="form-control" placeholder="0.00" required>
                                <span asp-validation-for="Price" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label asp-for="CostPrice" class="form-label">Cost Price ($)</label>
                                <input asp-for="CostPrice" type="number" step="0.01" class="form-control" placeholder="0.00">
                                <span asp-validation-for="CostPrice" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label asp-for="StockQuantity" class="form-label">Stock Quantity *</label>
                                <input asp-for="StockQuantity" type="number" class="form-control" placeholder="0" required>
                                <span asp-validation-for="StockQuantity" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label asp-for="LowStockThreshold" class="form-label">Low Stock Alert</label>
                                <input asp-for="LowStockThreshold" type="number" class="form-control" placeholder="10" value="10">
                                <span asp-validation-for="LowStockThreshold" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Description" class="form-label">Full Description</label>
                <textarea asp-for="Description" class="form-control" rows="4" placeholder="Detailed product description"></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label asp-for="MainImage" class="form-label">Main Image URL</label>
                        <input asp-for="MainImage" class="form-control" placeholder="https://example.com/image.jpg">
                        <span asp-validation-for="MainImage" class="text-danger"></span>
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="MetaTitle" class="form-label">Meta Title (SEO)</label>
                        <input asp-for="MetaTitle" class="form-control" placeholder="SEO title">
                        <span asp-validation-for="MetaTitle" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label asp-for="MetaDescription" class="form-label">Meta Description (SEO)</label>
                        <textarea asp-for="MetaDescription" class="form-control" rows="2" placeholder="SEO description"></textarea>
                        <span asp-validation-for="MetaDescription" class="text-danger"></span>
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="MetaKeywords" class="form-label">Meta Keywords (SEO)</label>
                        <input asp-for="MetaKeywords" class="form-control" placeholder="keyword1, keyword2">
                        <span asp-validation-for="MetaKeywords" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <div class="form-check mb-3">
                        <input asp-for="Status" class="form-check-input" checked>
                        <label asp-for="Status" class="form-check-label">Active (visible to customers)</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-check mb-3">
                        <input asp-for="IsFeatured" class="form-check-input">
                        <label asp-for="IsFeatured" class="form-check-label">Featured Product</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-check mb-3">
                        <input asp-for="IsBestSeller" class="form-check-input">
                        <label asp-for="IsBestSeller" class="form-check-label">Best Seller</label>
                    </div>
                </div>
            </div>

            <div class="form-actions mt-4 pt-4 border-top">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Create Product
                </button>
                <a asp-action="Index" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Auto-generate SKU if empty
            $('#SKU').on('blur', function() {
                if (!$(this).val()) {
                    const sku = 'PROD-' + Math.random().toString(36).substr(2, 8).toUpperCase();
                    $(this).val(sku);
                }
            });

            // Auto-generate slug from product name
            $('#Name').on('blur', function() {
                const name = $(this).val();
                const slugField = $('#Slug');

                if (name && (!slugField.val() || slugField.val().trim() === '')) {
                    const slug = name.toLowerCase()
                        .trim()
                        .replace(/[^\w\s-]/g, '')
                        .replace(/[\s_-]+/g, '-')
                        .replace(/^-+|-+$/g, '');
                    slugField.val(slug);
                }
            });

            // Auto-generate meta title from product name
            $('#Name').on('blur', function() {
                const name = $(this).val();
                const metaTitleField = $('#MetaTitle');

                if (name && (!metaTitleField.val() || metaTitleField.val().trim() === '')) {
                    metaTitleField.val(name + ' - Product');
                }
            });

            // Auto-generate meta description from short description
            $('#ShortDescription').on('blur', function() {
                const desc = $(this).val();
                const metaDescField = $('#MetaDescription');

                if (desc && (!metaDescField.val() || metaDescField.val().trim() === '')) {
                    metaDescField.val(desc.substring(0, 150));
                }
            });
        });
    </script>
}