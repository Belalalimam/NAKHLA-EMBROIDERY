@model NAKHLA.Models.Brand
@{
    ViewBag.Title = "Create Brand";
    ViewBag.PageTitle = "Add New Brand";
    ViewBag.Subtitle = "Create a new product brand";
}

<!-- Back button -->
<div class="mb-4">
    <a href="/admin/brands" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Brands
    </a>
</div>

<!-- Form Container -->
<div class="card">
    <div class="card-header">
        <h4>Brand Information</h4>
    </div>
    <div class="card-body">
        <!-- REMOVED: <form method="post"> -->
        <!-- The Html.BeginForm creates the form tag automatically -->
        @using (Html.BeginForm("Create", "Brands", FormMethod.Post, new { id = "createBrandForm" }))
        {
            @Html.AntiForgeryToken()

            <!-- Add validation summary for all errors -->
            @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        @Html.LabelFor(model => model.Name, new { @class = "form-label" })
                        @Html.TextBoxFor(model => model.Name, new {
                            @class = "form-control",
                            required = "required",
                            placeholder = "Enter brand name",
                            autofocus = "autofocus"
                        })
                        @Html.ValidationMessageFor(model => model.Name, null, new { @class = "text-danger" })
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        @Html.LabelFor(model => model.Status, new { @class = "form-label" })
                        @Html.DropDownListFor(model => model.Status,
                            new SelectList(new[] { "Active", "Inactive", "Pending" }, "Active"),
                            new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Status, null, new { @class = "text-danger" })
                    </div>
                </div>
            </div>

            <div class="form-group mb-3">
                @Html.LabelFor(model => model.Description, new { @class = "form-label" })
                @Html.TextAreaFor(model => model.Description, new {
                    @class = "form-control",
                    rows = "3",
                    placeholder = "Enter brand description (optional)"
                })
                @Html.ValidationMessageFor(model => model.Description, null, new { @class = "text-danger" })
            </div>

            <div class="form-group mb-3">
                @Html.LabelFor(model => model.Website, new { @class = "form-label" })
                @Html.TextBoxFor(model => model.Website, new {
                    @class = "form-control",
                    type = "url",
                    placeholder = "https://example.com"
                })
                @Html.ValidationMessageFor(model => model.Website, null, new { @class = "text-danger" })
            </div>

            <div class="form-check mb-4">
                @Html.CheckBoxFor(model => model.IsFeatured, new { @class = "form-check-input" })
                @Html.LabelFor(model => model.IsFeatured, "Featured Brand", new { @class = "form-check-label" })
                <small class="text-muted d-block">Featured brands will be highlighted on the homepage</small>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Brand
                </button>
                <a href="/admin/brands" class="btn btn-secondary">Cancel</a>
            </div>
        }
        <!-- REMOVED: </form> -->
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Client-side validation
            $('#createBrandForm').validate({
                rules: {
                    Name: {
                        required: true,
                        minlength: 2
                    },
                    Website: {
                        url: true
                    }
                },
                messages: {
                    Name: {
                        required: "Brand name is required",
                        minlength: "Brand name must be at least 2 characters"
                    },
                    Website: {
                        url: "Please enter a valid URL (e.g., https://example.com)"
                    }
                },
                errorElement: 'span',
                errorClass: 'text-danger',
                highlight: function(element) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element) {
                    $(element).removeClass('is-invalid');
                },
                submitHandler: function(form) {
                    // Show loading state on button
                    const submitBtn = $(form).find('button[type="submit"]');
                    const originalText = submitBtn.html();
                    submitBtn.html('<i class="fas fa-spinner fa-spin"></i> Saving...');
                    submitBtn.prop('disabled', true);

                    // Allow form to submit normally
                    return true;
                }
            });

            // Re-enable button if validation fails
            $('#createBrandForm').on('invalid-form.validate', function() {
                const submitBtn = $(this).find('button[type="submit"]');
                submitBtn.html('<i class="fas fa-save"></i> Save Brand');
                submitBtn.prop('disabled', false);
            });
        });
    </script>
}